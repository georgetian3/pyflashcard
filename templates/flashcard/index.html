<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Flashcard</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    </head>

    <script>
        window.addEventListener('keyup', function(event) {
            if (event.keyCode === 40) {
                reveal();
            } else if (event.keyCode === 37) {
                document.getElementById('demote').click()
            } else if (event.keyCode === 39) {
                document.getElementById('promote').click()
            }
        });

        function draw() {
            document.getElementById('reveal').disabled = false;
            document.getElementById('demote').disabled = true;
            document.getElementById('promote').disabled = true;

            $.ajax({
                data: {"draw": null},
                url: '/flashcard/index',
                success: function (response) {
                    document.getElementById('key').innerHTML = response['key']
                    document.getElementById('delete_modal_header').innerHTML = `Delete ${response['key']}?`
                    document.getElementById('value').innerHTML = response['value']
                    console.log(response)
                },
                error: function (response) {
                    alert("AJAX error", response)
                }
            });
        }

        function reveal() {
            document.getElementById('value').style.display = "block";
            document.getElementById('reveal').disabled = true;
            document.getElementById('demote').disabled = false;
            document.getElementById('promote').disabled = false;
        }
        function answer(answer) {
            document.getElementById('content').style.display = "none";
            $.ajax({
                data: {"answer": answer},
                url: '/flashcard/index',
                success: function (response) {
                    draw();
                },
                error: function (response) {
                    alert("AJAX error", response)
                }
            });
        }
        function add(key) {
            $.ajax({
                data: {'add': key},
                url: '/flashcard/index',
                success: function (response) {
                    if (response) {
                        alert(`${key} added`)
                    } else {
                        alert(`${key} not added`)
                    }
                    console.log(response)
                },
                error: function (response) {
                    alert("AJAX error", response)
                }
            });
        }
        draw();
    </script>

    <style>
        body {
            margin-top: 2%;
            margin-bottom: 2%;
            margin-left: 5%;
            margin-right: 5%;
        }
        #floating_footer {
            position: fixed;
            left: 2%;
            right: 2%;
            bottom: 2%;
            text-align: center;
        }
        #key {
            text-align: center;
            font-family: Times New Roman, SimSun;
            text-decoration: none;
            font-size: 64px;
        }
        #value {
            font-family: Times New Roman, SimSun;
            /*display: none;*/
            font-size: 32px;
        }
    </style>


    <body>
        <div id='main'>
            <div id='key'>{{word}}</div>
            <div id='value'>{{content|safe}}fff fff fffffff ffff fffff ffff ffffffffffffffffffaksd jfasdj aio; wejf oaw ijfal wej fa wlejf awl;efij</div>
        </div> 

        <div id='floating_footer'>
            <div>
                <button id='add_button' type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#add_modal">Add</button>
                <button id='reveal' type="button" class="btn btn-outline-primary" onclick=reveal()>Reveal</button>
                <button id='demote' type="button" class="btn btn-outline-primary" onclick=answer(false) disabled>Demote</button>
                <button id='promote' type="button" class="btn btn-outline-primary" onclick=answer(true) disabled>Promote</button>
                <button id='delete_button' type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#delete_modal">Delete</button>
                
            </div>

            <br>

            <div class="progress">
                <div class="progress-bar progress-bar-striped" role="progressbar" style="width:80%" data-toggle="tooltip" title="Tooltip">
                  Free Space
                </div>
                <div class="progress-bar progress-bar-striped" role="progressbar" style="width:10%">
                  Warning
                </div>
                <div class="progress-bar progress-bar-striped" role="progressbar" style="width:20%; background-color: aqua;">
                  Danger
                </div>
              </div>
        </div>

    </body>


    <div class="modal" id="add_modal">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <input type="text" class="form-control" id="key_input" placeholder="New Key">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick='add(document.getElementById("key_input").value)'>Save</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="delete_modal">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div id="delete_modal_header" class="modal-header"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="delete">Delete</button>
                </div>
            </div>
        </div>
    </div>

</html>